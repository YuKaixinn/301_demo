# 开发过程文档

## 1. 项目概述

本项目为基于 Electron 的采集与分析平台，核心功能包含问卷采集、生理参数采集与数据分析三大板块。系统设置用于运行环境配置与外部软件路径管理，不作为业务功能模块单独计入。前端负责界面渲染与交互，主进程负责系统能力调用与数据存取，二者通过 IPC 通信完成业务闭环。

## 2. 重大版本演进与开发过程记录

### 2.1 初版：启动采集后目录监听与自动分析

- 软件启动后监视相关数据目录
- 采集文件生成后自动触发对应分析流程
- 分析结果直接回填到前端结果区域

### 2.2 后续版本：分析触发方式重构

- 自动监听模式改为手动导入与按被试编号分析
- 保留对批量数据的支持，提升稳定性与可控性
- 分析入口统一收敛到分析页面，便于流程管理

### 2.3 数据存储机制演进

- 从数据库依赖迁移为文件化存储（JSON/CSV）
- 统一由主进程负责读写与导出
- 便于部署与运维，降低环境依赖

## 3. 模块功能说明

### 3.1 问卷模块（Questionnaire）

**功能目标**：完成问卷采集、基础信息填写、问卷保存与后续分析的数据准备。

**界面组成**：
- **基本信息区**：被试编号、姓名、性别、年龄、学历等字段，用于统一身份标识与数据归档。
- **问卷题目区**：依据配置文件动态渲染题目与选项。
  - index.html
  - renderer.js

**数据与状态**：
- 默认问卷配置通过 IPC 从主进程读取，驱动题目渲染与评分计算
- 表单校验依赖被试编号，作为后续分析与数据归档的主键
  - renderer.js

**交互流程**：
- 页面首次进入时加载默认问卷配置
- 用户填写基础信息与题目选项
- 提交后计算量表分数并保存到本地缓存
- 保存动作通过 IPC 调用主进程完成落盘
  - renderer.js
  - preload.js

**结果用途**：
- 问卷分数作为分析模块雷达图的输入数据
- 问卷历史记录支持后续追溯与批量分析
  - main.js

### 3.2 生理参数采集模块（EMG / ECG / Eye）

**功能目标**：快速启动外部采集软件，并记录与导出采集结果。

**界面组成**：
- EMG / ECG / Eye 启动入口
- 血压与心率记录区（实验前/后）
  - index.html

**数据结构**：
- 采集相关数据按被试编号分组保存
- 血压/心率字段以 pre_/post_ 前缀区分实验前后
  - renderer.js

**交互流程**：
- 点击启动按钮，通过 IPC 调用主进程启动外部软件
- 血压与心率数据提交后写入本地缓存并支持历史查询
  - renderer.js
  - main.js

**异常处理**：
- 启动失败反馈错误提示
- 缺少被试编号时阻止保存并提示补充
  - renderer.js

### 3.3 数据分析模块（Questionnaire / ECG / EMG / Eye / Game）

**功能目标**：导入或拉取数据，完成统计与可视化输出。

**分析入口**：
- 统一在分析页面触发各模块分析动作
- 依赖被试编号读取最新数据进行可视化
  - renderer.js

**问卷分析**：
- 根据被试编号读取最新问卷数据
- 生成大五人格与心理资本雷达图
- 生成指标表格展示量表分数
  - renderer.js

**ECG/EMG 分析**：
- 支持导入数据并展示核心指标
- 渲染时序曲线图进行趋势观察
  - renderer.js

**眼动分析**：
- 支持导入眼动数据并生成指标
- 渲染注视点热力图，支持批量多图显示
  - renderer.js
  - utils/physio_analysis.js

**游戏成绩分析**：
- 支持一键分析被试成绩
- 支持单独导入文件分析
- 结果可保存并支持历史回看
  - renderer.js

## 4. 系统设置与运行环境配置

**定位说明**：系统设置属于运行环境配置与外部依赖管理，辅助业务模块稳定运行，不作为核心业务功能模块统计。

**功能目标**：配置外部软件路径与数据输出目录，保证启动稳定与数据可追溯。

**功能说明**：
- 支持选择 exe 路径与数据目录
- 保存后持久化到用户配置文件
  - renderer.js
  - preload.js
  - main.js

**配置读取流程**：
- 应用启动后读取配置并回填到输入框
- 用户选择新的路径后即刻写入配置
  - renderer.js

## 5. Electron 架构与通信机制

### 5.1 主进程（Main）

**职责**：
- 创建窗口并加载前端页面
- 提供数据保存与读取服务
- 启动外部采集程序
- 管理进程状态与错误处理
  - main.js

### 5.2 预加载脚本（Preload）

**职责**：
- 在隔离上下文中暴露安全 API
- 统一封装 IPC 调用接口
  - preload.js

### 5.3 渲染进程（Renderer）

**职责**：
- 负责 UI 渲染与事件绑定
- 调用后端 API 获取数据与更新视图
- 执行图表绘制与页面状态管理
  - renderer.js

## 6. 关键数据流说明

### 6.1 问卷数据流

- 问卷配置读取 → 题目渲染 → 用户提交 → 计算量表分数 → 保存文件
  - renderer.js
  - main.js

### 6.2 问卷分析数据流

- 拉取最新问卷 → 生成雷达图 → 生成指标表格
  - renderer.js

### 6.3 眼动热力图数据流

- 眼动原始数据解析 → 生成热力图数据 → 前端渲染
  - utils/physio_analysis.js
  - renderer.js

### 6.4 生理指标与导出

- 计算分析结果 → 展示指标 → 导出汇总
  - renderer.js

### 6.5 外部软件启动流程

- 前端触发启动 → IPC 调用 → 主进程 spawn 外部程序 → 状态回传
  - renderer.js
  - main.js

## 7. 总结

本次文档重点说明各业务模块的功能边界与流程串联，包括：
- 前端页面结构与模块职责
- Electron 架构中主进程、预加载、渲染进程的协作方式
- 问卷、生理分析、眼动热力图等关键数据流的闭环路径
- 采集与分析模块的输入、处理、输出关系

该文档可用于后续维护、功能扩展与项目交接。
